<html>
   <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Metric-based App Rating System</title>

      <script src="js/jquery-2.1.4.js"></script>
      <script src="js/bootstrap.js"></script>
      <link href="css/bootstrap.css" rel="stylesheet">
      <link href="css/arm.css" rel="stylesheet" type="text/css"></link>
   </head>

   <body>
      <div id="container">
         <h1>Metric-Based App Rating System Prototype</h1>

         <span>
            <b>App to analyze: </b>
            <select>
               <option value="14831371782">Textra (product: 14831371782)</option>
            </select>
         </span>
         </br>
         <span>
            <b>Metric to use: </b>
            <select>
               <option value="sentiment">Level of Sentiment</option>
               <option value="verbosity">Verbosity</option>
            </select>
         </span>

         <div id="chartContainer">
            <canvas id="myChart" width="400" height="400"></canvas>
            <div id="legend"></div>

            <script src="js/Chart.js"></script>
            <script>
               document.getElementById("myChart").style.width = "640";
               document.getElementById("myChart").style.height = "480";

               var results = null;

               // Query our API for
               $.get('http://localhost:5000/apps/14831371782', function(data) {
                  var ratings = [];

                  for (obj of data) {
                     ratings.push(obj.stars);
                  }

                  ratings = ratings.reverse(); // I think the results are returned newest to oldest

                  // Get the context of the canvas element we want to select
                  var ctx = document.getElementById("myChart").getContext("2d");

                  var data = {
                      labels: ["January", "February", "March", "April", "May", "June", "July"],
                      datasets: [
                          {
                              label: "Original Ratings",
                              fillColor: "rgba(220,220,220,0.2)",
                              strokeColor: "rgba(220,220,220,1)",
                              pointColor: "rgba(220,220,220,1)",
                              pointStrokeColor: "#fff",
                              pointHighlightFill: "#fff",
                              pointHighlightStroke: "rgba(220,220,220,1)",
                              data: ratings
                          },
                          {
                              label: "[METRIC] Rating",
                              fillColor: "rgba(151,187,205,0.2)",
                              strokeColor: "rgba(151,187,205,1)",
                              pointColor: "rgba(151,187,205,1)",
                              pointStrokeColor: "#fff",
                              pointHighlightFill: "#fff",
                              pointHighlightStroke: "rgba(151,187,205,1)",
                              data: [1, 2, 3, 3.5, 4, 4.5, 4]
                          }
                      ]
                  };

                   var options = {

                      ///Boolean - Whether grid lines are shown across the chart
                      scaleShowGridLines : true,

                      //String - Colour of the grid lines
                      scaleGridLineColor : "rgba(0,0,0,.05)",

                      //Number - Width of the grid lines
                      scaleGridLineWidth : 1,

                      //Boolean - Whether to show horizontal lines (except X axis)
                      scaleShowHorizontalLines: true,

                      //Boolean - Whether to show vertical lines (except Y axis)
                      scaleShowVerticalLines: true,

                      //Boolean - Whether the line is curved between points
                      bezierCurve : true,

                      //Number - Tension of the bezier curve between points
                      bezierCurveTension : 0.4,

                      //Boolean - Whether to show a dot for each point
                      pointDot : true,

                      //Number - Radius of each point dot in pixels
                      pointDotRadius : 4,

                      //Number - Pixel width of point dot stroke
                      pointDotStrokeWidth : 1,

                      //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
                      pointHitDetectionRadius : 20,

                      //Boolean - Whether to show a stroke for datasets
                      datasetStroke : true,

                      //Number - Pixel width of dataset stroke
                      datasetStrokeWidth : 2,

                      //Boolean - Whether to fill the dataset with a colour
                      datasetFill : true,

                      //String - A legend template
                      legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

                  };

                  var myLineChart = new Chart(ctx).Line(data, options);

                  document.getElementById("legend").innerHTML = myLineChart.generateLegend();
               });

            </script>
         </div>
      </div>
   </body>

</html>
